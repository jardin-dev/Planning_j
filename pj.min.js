/*!
 * Planning 
 * Version: 2.5 17/04/23 
 *
 * Copyright (c) 2019 - 2023 ALL RIGHTS RESERVED
 * auteur Mickael FEUVRIER
 * 
*/

 $(()=>{$("<div />").attr("id","drawer").appendTo("#planning"),$("<div />").attr("id","toolbar").appendTo("#drawer"),$("<div />").attr("id","context-menu").appendTo("#drawer"),$("<div />").attr("id","scheduler").appendTo("#drawer"),$("<div />").attr("id","loadpanel").appendTo("#planning");class e{constructor(e,t){this.type=e,this.value=t}}class t{constructor(e,t){if(void 0!==t)return t;return $.grep(M._array,t=>t.id===e)[0].defautSalId}}class a{constructor(e,t,a){this.script=e,this.param=t,this.option=a}}let n=[],i=null,o=null,d=null,l=null,r=null,s=null,u=null,c=!0,m=!0,h=$(window).height(),v=[{text:"Nouveau",onItemClick:eS,disabled:!1},{text:"Grouper par \xe9quipe",beginGroup:!0,onItemClick:eT},{text:"Aller \xe0 aujourd'hui",onItemClick:eO}],g=[{text:"Ouvrir",onItemClick:ek},{text:"Supprimer",onItemClick:eA},{text:"Dupliquer",onItemClick:e8},{text:"Statut",beginGroup:!0,items:[{text:"Rendez-vous",onItemClick:e9},{text:"Message",onItemClick:e9},{text:"Non appel\xe9",onItemClick:e9},{text:"D\xe9faut",onItemClick:e9}]},{text:"Salari\xe9",items:[]},{text:"D\xe9tail",beginGroup:!0,onItemClick:e2},{text:"Fiche travaux",onItemClick:e1},{text:"Contacter",onItemClick:eR},{text:"Suivi de chantier",beginGroup:!0,onItemClick:eV}];to(new Date),td(eb(new Date)),tu(new a("getDataAppointmentList","",0)),tu(new a("getDataParam","",0)),tu(new a("getDataEquipe","",0)),tu(new a("getDataPonctuel","",0)),tu(new a("getDataOffice","",0)),tu(new a("getDataJourChome","",0)),tu(new a("getDataSalarie","",0)),tu(new a("getDataAbsence","",0)),tu(new a("getListClients","",0));let x=new DevExpress.data.ArrayStore({data:[],key:"clt_ref"}),w=new DevExpress.data.DataSource({store:x,paginate:!0,reshapeOnPush:!1,pageSize:100}),b=new DevExpress.data.ArrayStore({data:[],key:"id",onInserted(t){let a=new e("insert",t);tl(a)},onUpdated(t,a){let n=new e("update",a);tl(n)},onRemoved(t){let a=new e("remove",t);tl(a)}}),f=new DevExpress.data.DataSource({store:b,paginate:!1,reshapeOnPush:!0}),D=new DevExpress.data.ArrayStore({data:[],key:"id"});new DevExpress.data.DataSource({store:D,paginate:!1,reshapeOnPush:!0});let _=new DevExpress.data.ArrayStore({data:[],key:"id",onPush(e){$("#list1").empty();eI(_._array)}}),C=new DevExpress.data.DataSource({store:_,paginate:!1,reshapeOnPush:!0}),y=new DevExpress.data.ArrayStore({data:[],key:"id",onPush(e){$("#list2").empty();eI(y._array)}}),T=new DevExpress.data.DataSource({store:y,paginate:!1,reshapeOnPush:!0}),S=new DevExpress.data.ArrayStore({data:[],key:"id",onInserted(e){ts("Office",e)},onUpdated(e,t){delete t.id,tr("Office",e,t)},onRemoved(e){tp("Office",e)}}),O=new DevExpress.data.DataSource({store:S,paginate:!1,reshapeOnPush:!0}),k=new DevExpress.data.ArrayStore({data:[],key:"id",onInserted(e){ts("Absence",e)},onUpdated(e,t){delete t.id,tr("Absence",e,t)},onRemoved(e){tp("Absence",e)}}),A=new DevExpress.data.DataSource({store:k,paginate:!1,reshapeOnPush:!0}),F=new DevExpress.data.ArrayStore({data:[],key:"id",onInserted(e){ts("Chome",e)},onUpdated(e,t){delete t.id,tr("Chome",e,t)},onRemoved(e){tp("Chome",e)}}),I=new DevExpress.data.ArrayStore({name:"salarie",data:[],key:"id",onInserted(e){ts("Salarie",e)},onUpdated(e,t){tr("Salarie",e,t)},onRemoved(e){tp("Salarie",e)}}),E=new DevExpress.data.DataSource({store:I,paginate:!1,reshapeOnPush:!0}),M=new DevExpress.data.ArrayStore({data:[],key:"id",onInserted(e){ts("Equipe",e)},onUpdated(e,t){tr("Equipe",e,t)},onRemoved(e){tp("Equipe",e)}}),B=new DevExpress.data.ArrayStore({data:[],key:"id",onUpdated(e,t){tr("Parametre",e,t)}});DevExpress.localization.locale(navigator.language),DevExpress.localization.formatMessage,$("#toolbar").dxToolbar({elementAttr:{class:"toolbar_header"},items:[{widget:"dxButton",location:"before",options:{icon:"menu",onClick(){q.toggle();let e=!0===q.option("opened")?1:0;B.update(B._array[0].id,{drawer:e})},elementAttr:{class:"buttonPanel"}}}]}).dxToolbar("instance");let q=$("#drawer").dxDrawer({opened:!1,height:h,elementAttr:{class:"drawer-planning"},width:"100%",closeOnOutsideClick:!1,openedStateMode:"shrink",template(){let e=$("<div />").addClass("panel-content-accordion"),t=$("<div />").width(250).addClass("panel-accordion");return t.append(e)},onOptionChanged(){let e=$(".buttonPanel");e.hasClass("panelOpened")?e.removeClass("panelOpened"):e.addClass("panelOpened")}}).dxDrawer("instance"),R=$("#loadpanel").dxLoadPanel({shadingColor:"rgba(0,0,0,0.4)",position:{of:"#drawer"},height:"100vh",width:"100vw",visible:!1,showIndicator:!0,showPane:!0,shading:!0,hideOnOutsideClick:!1}).dxLoadPanel("instance");R.show();let P=$("#scheduler").dxScheduler({height:"100vh",useDropDownViewSwitcher:!0,dataSource:f,adaptivityEnabled:!1,showAllDayPanel:!1,showCurrentTimeIndicator:!1,firstDayOfWeek:1,currentView:"semaine",crossScrollingEnabled:!1,groupByDate:!0,startDayHour:8,endDayHour:18.5,allowDragging:c,groups:["equipeID"],editing:{allowDragging:c,allowAdding:m},views:[{type:"workWeek",name:"semaine"}],resources:[{key:"equipeID",fieldExpr:"equipeID",allowMultiple:!1,dataSource:[ep([],new Date)],label:"Equipe"},{fieldExpr:"salarieID",allowMultiple:!0,dataSource:I,label:"Salari\xe9"},{fieldExpr:"statut",label:"Statut",dataSource:[{text:"Rendez-vous"},{text:"Message"},{text:"Non appel\xe9"},{text:"D\xe9faut"}]}],appointmentDragging:{group:"dragging",onRemove(e){e.component.deleteAppointment(e.itemData),eE(e.itemData,$(`#list${e.itemData.devis.typeID}`)),$(`.sem-${ex(P.option("currentDate"))}`).css("display","block")},onAdd(e){e.itemData.salarieID=er(new Date(e.itemData.startDate),e.itemData.equipeID),e.component.addAppointment(e.itemData),e.itemElement.remove()},onDragMove(e){c=!$(".dx-scheduler-date-table-droppable-cell").hasClass("dx-template-chome")},onDragEnd(e){!1===c?e.cancel=!0:e.cancel=!1}},onAppointmentRendered(){en()},onAppointmentUpdated(e){e.component.repaint(),e.component.on([{repaint:eo()}])},onAppointmentUpdating(e){(e.oldData.equipeID!=e.newData.equipeID||new Date(e.oldData.startDate).getDay()!=new Date(e.newData.startDate).getDay())&&(e.newData.salarieID=er(new Date(e.newData.startDate),e.newData.equipeID))},timeCellTemplate(e,t,a){a.text(e.text).css({color:"#469f11",height:ei()})},appointmentTemplate(e){let t=new Date(e.appointmentData.startDate).toLocaleTimeString(),a=new Date(e.appointmentData.endDate).toLocaleTimeString(),n,i,o=e.appointmentData.salarieID;switch(e.appointmentData.statut){case"Rendez-vous":n="rdv";break;case"Message":n="mes";break;case"Non appel\xe9":n="na";break;default:n="def"}i=void 0===e.appointmentData.statut?"":e.appointmentData.statut;let d=$("<div />").addClass(["app-content",`${n}`]),l=$("<div />").html(`${e.appointmentData.devis.text}`).addClass("app-text"),r=$("<div />").html(`${t.slice(0,-3)} - ${a.slice(0,-3)}`).addClass("app-hour"),s=$("<div />").html(`${i}`).addClass("app-statut"),u=$("<div />").addClass("member");return d.append([l,r,s,u]),$.each(o,()=>{$("<i />").addClass("dx-icon user-icon dx-icon-user").appendTo(u)}),d},dataCellTemplate(e,t,a){a.css("height",ei());let n=e.startDate.getTime(),i=e.groups.equipeID;B.load().done(t=>{for(let[n,i]of t.entries()){let o=`${e.startDate.getHours()}:${e.startDate.getMinutes()}:00`;o>=`${i.pause.from}:00`&&o<`${i.pause.to}:00`&&a.addClass("dx-template-Pose")}}),S.load().done(e=>{for(let[t,o]of e.entries()){let d=new Date(e[t].startDate),l;switch(e[t].periodeID){case 1:l=(d=d.getTime()+288e5)+144e5;break;case 2:l=(d=d.getTime()+468e5)+18e6;break;case 3:l=(d=d.getTime()+288e5)+432e5}d<=n&&l>=n&&3==i&&a.addClass("dx-template-Office")}}),F.load().done(e=>{for(let[t,i]of e.entries()){let o=new Date(e[t].startDate),d=new Date(e[t].endDate);o.getTime()<=n&&d.getTime()>=n&&a.addClass("dx-template-chome")}})},appointmentTooltipTemplate(e){let t=new Date(e.appointmentData.startDate).toLocaleTimeString(),a=new Date(e.appointmentData.endDate).toLocaleTimeString(),n=$("<div />");return $("<div />").text(e.appointmentData.devis.text).appendTo(n),$("<div />").text(`${t.slice(0,-3)} - ${a.slice(0,-3)}`).appendTo(n),n},onAppointmentFormOpening(e){let t=new Date(e.appointmentData.startDate).getTime(),a=new Date(e.appointmentData.endDate).getTime();F.load().done(n=>{for(let[i,o]of n.entries()){let d=new Date(n[i].startDate),l=new Date(n[i].endDate);d.getTime()<=t&&l.getTime()>=a&&(e.cancel=!0,e3(X))}}),e.form.option({labelMode:"floating",colCountByScreen:{lg:1,sm:1},items:ed(e)})},onOptionChanged(e){if("currentDate"===e.name){let t=P.option("currentDate");R.option("visible",!0),i&&"hoursOffice-popup"==i._customWrapperClass&&i.resetOption("contentTemplate"),e0(),P.option("resources[0].dataSource",ep(B._array[0].teams,t)),to(t),td(eb(t)),$(".itemSem").css("display","none"),$(`.sem-${ex(t)}`).css("display","block"),$("#button-sem .dx-button-text").text(ex(t)),P.repaint(),P.on([{repaint:eo()}]),tu(new a("save_date",P.option("currentDate"),0))}if("groupByDate"===e.name){let n=P.option("currentDate");$("#button-sem .dx-button-text").text(ex(n))}},onAppointmentContextMenu(e){let t;t=3==e.appointmentData.equipeID?(t=el(e.appointmentData.startDate,e.appointmentData.equipeID)).filter(e=>e.id==ea()):el(e.appointmentData.startDate,e.appointmentData.equipeID),$.each(t,(a,n)=>{let i=t[a].id;-1!=$.inArray(i,e.appointmentData.salarieID)?n.checked=!0:n.checked=!1,n.onSelectionChanged=eF,n.onItemClick=eF,n.text=t[a].prenom});let a=g.find(e=>"D\xe9tail"===e.text),n=(g.find(e=>"Suivi de chantier"===e.text),g.find(e=>"Fiche travaux"===e.text)),i=g.find(e=>"Salari\xe9"===e.text);i.items=[],$.each(t,(e,t)=>{i.items.push(t)}),e.appointmentData.devis.dvs_ref?a.disabled=!1:a.disabled=!0,e.appointmentData.devis.dvs_ref?n.disabled=!1:n.disabled=!0,eD(!1,g,eC,e_(e),".dx-scheduler-appointment")},onCellContextMenu(e){$(e.cellElement[0]).hasClass("dx-template-chome")?(v[0].disabled=!0,eD(!1,v,ey,e_(e),".dx-scheduler-date-table-cell")):(v[0].disabled=!1,eD(!1,v,ey,e_(e),".dx-scheduler-date-table-cell"))}}).dxScheduler("instance"),V=$("#context-menu").dxContextMenu({width:200,dataSource:[],disabled:!0,target:".dx-scheduler-appointment"}).dxContextMenu("instance"),j={width:310,height:365,title:"Semaine",dragEnabled:!1,closeOnOutsideClick:!0,showCloseButton:!0,wrapperAttr:{class:"sem-popup"},shading:!0,shadingColor:"#00000050",container:".dx-viewport",contentTemplate(e){let t=$("<div />").addClass("wrapper-popup-week"),a=$("<div/>").appendTo(t).addClass("year-select"),n=$("<div />").dxTextBox({name:"select-Year",value:new Date(e$()).getFullYear(),width:200,buttons:[{location:"after",name:"prev",options:{icon:"chevronright",onClick(){let e=n.dxTextBox("instance");e.option("value",e.option("value")+1)}}},{location:"before",name:"next",options:{icon:"chevronleft",onClick(){let e=n.dxTextBox("instance");e.option("value",e.option("value")-1)}}}]});n.appendTo(a);let o=$("<div />").addClass("wrapper-sem").appendTo(t);for(let d=1;d<=53;d++){let l=$("<div />").addClass(`num-sem num-sem${d}`).dxButton({stylingMode:"outlined",elementAttr:{sem:d},text:d,type:"normal",width:32,height:32,onClick(e){let t=n.dxTextBox("instance");ef(parseInt(e.element[0].attributes.sem.value),t.option("value")),i.hide()}});o.append(l)}return t},position:{my:"right top",at:"left top",of:".sem",offset:"0 10"}},G={width:260,height:320,showTitle:!0,title:"heures de bureau",showCloseButton:!0,dragEnabled:!1,closeOnOutsideClick:!0,shading:!0,shadingColor:"#00000050",container:".dx-viewport",wrapperAttr:{class:"hoursOffice-popup"},position:{my:"left center",at:"right center",of:".buttonOffice",offset:"10 20"},contentTemplate(){let e=P.getStartViewDate(),t=$("<div />").addClass("wrapper-hoursOffice-popup"),a;return $(".dx-scheduler-header-panel-cell").each((n,i)=>{let o=new Date(e);o.setDate(e.getDate()+n);let d=eX(o);O.filter("startDate",d),O.load().done(e=>{a=0!=e.length?e[0].periodeID:0});let l=$(i).children().clone(),r=$("<div />").addClass("contener-jourOffice").html(l),s=$("<div />").addClass(`contener-select select-num-${n}`).data("day",d).dxSelectBox({dataSource:[{periode:"Journ\xe9e",periodeID:3},{periode:"Matin",periodeID:1},{periode:"Apr\xe8s-midi",periodeID:2}],displayExpr:"periode",valueExpr:"periodeID",value:a,width:"150px",showClearButton:!0,onValueChanged(e){es(e)}});r.appendTo(t),s.appendTo(t)}),t},toolbarItems:[{visible:!1}]},L={width:610,height:435,title:"Absence des salari\xe9s",dragEnabled:!1,closeOnOutsideClick:!0,showCloseButton:!0,shading:!0,shadingColor:"#00000050",container:".dx-viewport",wrapperAttr:{class:"grid-salAbsence-popup"},position:{my:"center",at:"center",of:"window"},contentTemplate(){let e=$("<div />").addClass("wrapper-grid-salAbs-popup");return e.dxDataGrid({elementAttr:{id:"grid-salarie-absence"},dataSource:k,scrolling:{mode:"infinite"},height:"350px",showColumnLines:!0,showBorders:!0,headerFilter:{visible:!1},columns:[{dataField:"salarieID",width:150,caption:"Nom",setCellValue(e,t){e.salarieID=t},lookup:{dataSource:I,valueExpr:"id",displayExpr:"prenom"}},{dataField:"startDate",dataType:"datetime",caption:"Date de d\xe9but",width:170,sortOrder:"desc"},{dataField:"endDate",dataType:"datetime",caption:"Date de fin",width:170}],editing:{mode:"form",allowUpdating:!0,allowDeleting:!0,allowAdding:!0}}).dxDataGrid("instance"),e},toolbarItems:[{visible:!1}]},N={width:500,height:350,title:"ajouter un salari\xe9",dragEnabled:!1,closeOnOutsideClick:!1,showCloseButton:!1,shading:!0,shadingColor:"#00000050",container:".dx-viewport",wrapperAttr:{class:"addSal-popup"},position:{my:"center",at:"center",of:"window"},contentTemplate(){let e=$("<div />").addClass("wrapper-AddSall-popup"),t=$("<div />").addClass("form-addSal").appendTo(e),a=$("<div />").addClass("toolbar-addSal").appendTo(e),n=t.dxForm({readOnly:!1,showColonAfterLabel:!0,height:"auto",minColWidth:300,colCount:2,showValidationSummary:!1,validationGroup:"formAddSal",labelMode:"floating",labelLocation:"left",items:[{name:"nom",dataField:"nom",label:{text:"Nom"},editorOptions:{value:"",disabled:!1},validationRules:[{type:"required",message:"le nom est requis"}]},{dataField:"prenom",label:{text:"pr\xe9nom"},editorOptions:{value:"",disabled:!1},validationRules:[{type:"required",message:"le pr\xe9nom est requis"}]},{dataField:"ctr",label:{text:"Contrat"},editorType:"dxSelectBox",colSpan:2,editorOptions:{items:["partage","CDD","CDI"],searchEnabled:!0,value:"",onValueChanged(e){"CDI"!==e.value?$(".ctr-date").show():($(".ctr-date").hide(),n.option("items[3].editorOptions.value","01/01/2000"),n.option("items[4].editorOptions.value","01/01/2100"))}},validationRules:[{type:"required",message:"le type de contrat est requis"}]},{dataField:"startDate",cssClass:"ctr-date startDate",label:{text:"date de d\xe9but de contrat"},editorType:"dxDateBox",editorOptions:{value:"",width:"100%"},validationRules:[{type:"required",message:"la date de d\xe9but est requise"}]},{dataField:"endDate",cssClass:"ctr-date endDate",label:{text:"date de fin de contrat"},editorType:"dxDateBox",editorOptions:{value:"",width:"100%"},validationRules:[{type:"required",message:"la date de fin est requise"}]},{dataField:"actif",editorType:"dxCheckBox",label:{text:"Actif"},editorOptions:{value:!0}}]}).dxForm("instance");return a.dxToolbar({items:[{toolbar:"bottom",widget:"dxButton",location:"after",options:{text:"ok",validationGroup:"formAddSal",onClick:function e(t){if(!0===t.validationGroup.validate().isValid){let a=Object.defineProperty(n._options._optionManager._options.formData,"id",{value:eY()});a=Object.defineProperty(n._options._optionManager._options.formData,"actif",{value:1}),I.insert(a),i.hide()}}}},{toolbar:"bottom",widget:"dxButton",location:"after",options:{text:"Annuler",onClick(){i.hide()}}}]}),e},toolbarItems:[{visible:!1}]},U={width:475,height:520,title:"Salari\xe9s",dragEnabled:!1,closeOnOutsideClick:!0,showCloseButton:!0,shading:!0,shadingColor:"#00000050",container:".dx-viewport",wrapperAttr:{class:"grid-sal-popup"},position:{my:"center",at:"center",of:"window"},contentTemplate(){let e=$("<div />").addClass("wrapper-template-popup"),t=$("<div />").addClass("grid-showSal").appendTo(e),a=$("<div />").addClass("toolbar-showSal").appendTo(e),n=t.dxDataGrid({elementAttr:{id:"grid-salarie"},dataSource:I,filterValue:["actif",1],scrolling:{mode:"infinite"},height:"420px",showColumnLines:!0,showBorders:!0,headerFilter:{visible:!1},columns:[{dataField:"nom",dataType:"string",width:130,caption:"Nom"},{dataField:"prenom",dataType:"string",width:130,caption:"Pr\xe9nom"},{dataField:"ctr",dataType:"string",caption:"Contrat",width:100},{dataField:"actif",dataType:"number",caption:"Actif",visible:!1}],editing:{mode:"form",allowUpdating:!0,allowDeleting:!0,allowAdding:!1,form:{colCount:1,items:[{itemType:"group",colCount:2,items:[{dataField:"nom"},{dataField:"prenom"},{dataField:"ctr"},{dataField:"actif",editorType:"dxSwitch",editorOptions:{dataType:"number"}}]}]}},onRowUpdating(e){let t;t=e.newData.actif?1:0,Object.defineProperty(e.newData,"actif",{value:t})}}).dxDataGrid("instance");return a.dxToolbar({items:[{location:"before",widget:"dxCheckBox",options:{text:"Actif",value:1,onValueChanged(e){!0===e.value?n.option({filterValue:["actif",1]}):n.option({filterValue:null})}}}]}),e},toolbarItems:[{visible:!1}]},H={width:500,height:320,title:"ajouter une \xe9quipe",dragEnabled:!1,closeOnOutsideClick:!1,showCloseButton:!1,wrapperAttr:{class:"addEquipe-popup"},shading:!0,shadingColor:"#00000050",container:".dx-viewport",position:{my:"center",at:"center",of:"window"},contentTemplate(){let e;E.filter("actif",1),E.load().done(t=>{e=t});let t=$("<div />").addClass("wrapper-AddEquipe-popup"),a=$("<div />").addClass("form-addSal").appendTo(t),n=$("<div />").addClass("toolbar-addSal").appendTo(t),o=a.dxForm({name:"FORM_ADD_TEAM",readOnly:!1,showColonAfterLabel:!0,labelMode:"floating",labelLocation:"top",minColWidth:300,height:220,colCount:2,showValidationSummary:!1,validationGroup:"formAddEquip",items:[{dataField:"text",label:{text:"nom de l'\xe9quipe"},editorOptions:{colSpan:2,value:"",disabled:!1},validationRules:[{type:"required",message:"le nom d'\xe9quipe est requis"}]},{itemType:"empty"},{dataField:"startDate",label:{text:"date de d\xe9but"},editorType:"dxDateBox",editorOptions:{value:"",width:"100%"},validationRules:[{type:"required",message:"la date de d\xe9but est requise"}]},{dataField:"endDate",label:{text:"date de fin"},editorType:"dxDateBox",editorOptions:{value:"",width:"100%"},validationRules:[{type:"required",message:"la date de fin est requise"}]},{dataField:"defautSalId",label:{text:"salari\xe9 par d\xe9faut pour cette \xe9quipe"},editorType:"dxTagBox",editorOptions:{dataSource:e,displayExpr:"prenom",valueExpr:"id",showSelectionControls:!0,applyValueMode:"useButtons"},validationRules:[{type:"required",message:"vous devez selectionner au moin 1 salari\xe9"}]},{dataField:"color",label:{text:"couleur"},editorType:"dxColorBox",editorOptions:{applyButtonText:"ok"},validationRules:[{type:"required",message:"Choisissez une couleur"}]}]}).dxForm("instance");return n.dxToolbar({items:[{toolbar:"bottom",widget:"dxButton",location:"after",options:{text:"ok",validationGroup:"formAddEquip",onClick:function e(t){let a=t.validationGroup.validate(),n;!0===a.isValid&&(n=Object.defineProperty(o._options._optionManager._options.formData,"id",{value:eY()}),M.insert(n),e0(),i.hide())}}},{toolbar:"bottom",widget:"dxButton",location:"after",options:{text:"Annuler",onClick(e){i.hide()}}}]}),t},toolbarItems:[{visible:!1}]},z={width:700,height:550,title:"Voir les \xe9quipes",dragEnabled:!1,closeOnOutsideClick:!0,showCloseButton:!0,wrapperAttr:{class:"grid-salAbsence-popup"},shading:!0,shadingColor:"#00000050",container:".dx-viewport",position:{my:"center",at:"center",of:"window"},contentTemplate(){let e=$("<div />").addClass("wrapper-grid-showEquip-popup");return e.dxDataGrid({dataSource:M,height:"460px",showColumnLines:!0,showBorders:!0,headerFilter:{visible:!1},editing:{mode:"form",allowUpdating:!0,allowDeleting:!0,allowAdding:!1},onRowRemoved(e){let t=B._array[0].teams;t=t.filter(t=>t!==e.key),B.update(B._array[0].id,{teams:t})},columns:[{dataField:"text",width:110,caption:"Nom"},{dataField:"startDate",dataType:"datetime",caption:"Date de d\xe9but",width:110,sortOrder:"desc"},{dataField:"endDate",dataType:"datetime",caption:"Date de fin",width:110},{dataField:"defautSalId",width:150,caption:"Salari\xe9s par d\xe9faut",lookup:{dataSource:I,valueExpr:"id",displayExpr:"prenom"},cellTemplate(e,t){let a=(t.value||[]).map(e=>t.column.lookup.calculateCellValue(e)).join(", ");e.text(a||"\xa0").attr("title",a)},editCellTemplate:ez},{dataField:"color",width:100,caption:"Couleur",lookup:{dataSource:I,valueExpr:"id",displayExpr:"prenom"},cellTemplate(e,t){let a=$("<div />").css("backgroundColor",t.value).addClass("color-equipe");e.append(a)},editCellTemplate:eW}]}).dxDataGrid("instance"),e},toolbarItems:[{visible:!1}]},W={width:455,height:480,title:"Jours chom\xe9s",dragEnabled:!1,closeOnOutsideClick:!0,showCloseButton:!0,wrapperAttr:{class:"grid-unworkedDay-popup"},shading:!0,shadingColor:"#00000050",container:".dx-viewport",position:{my:"center",at:"center",of:"window"},contentTemplate(){let e=$("<div />").addClass("wrapper-grid-salAbs-popup");return e.dxDataGrid({dataSource:F,scrolling:{mode:"infinite"},height:"400px",showColumnLines:!0,showBorders:!0,headerFilter:{visible:!0},columns:[{dataField:"startDate",dataType:"date",caption:"Date de d\xe9but",width:170,sortOrder:"desc"},{dataField:"endDate",dataType:"date",caption:"Date de fin",width:170}],editing:{mode:"form",allowUpdating:!0,allowDeleting:!0,allowAdding:!0},onRowUpdated(){P.repaint(),P.on([{repaint:eo()}])},onRowInserted(){P.repaint(),P.on([{repaint:eo()}])},onRowRemoved(){P.repaint(),P.on([{repaint:eo()}])}}),e},toolbarItems:[{visible:!1}]},Y={width:455,height:480,title:"Recherche",dragEnabled:!1,closeOnOutsideClick:!0,showCloseButton:!0,wrapperAttr:{class:"grid-search-popup"},shading:!0,shadingColor:"#00000050",container:".dx-viewport",position:{my:"center",at:"center",of:"window"},contentTemplate(){let e=$("<div />").addClass("wrapper-grid-search-popup");return e.dxList({dataSource:D,scrolling:{mode:"infinite"},height:"400px",itemTemplate:function(e,t,a){a.append($("<b>").text(e.nom),$("<br />"),$("<p>").text(e.devis).css("margin",0),$("<p>").text(e.date).css("margin",0))},searchEnabled:!0,searchExpr:["nom","devis"],searchMode:"contains",pageLoadMode:"scrollBottom",onItemClick(e){let t=eK(e.itemData.date);P.option("currentDate",new Date(t)),i.hide()}}),e},toolbarItems:[{visible:!1}]};$(".panel-content-accordion").dxAccordion({dataSource:[{title:"Options",id:3},{title:"Ponctuel",id:2},{title:"Annuel",id:1}],animationDuration:300,collapsible:!0,multiple:!1,width:250,height:"auto",deferRendering:!1,itemTitleTemplate(e,t,a){let n=$("<span />").text(e.title);n.appendTo(a)},itemTemplate(e,t,a){let n=$("<div />").addClass("listContent").height(h-150>750?750:h-150),i=$("<div />").addClass("list scroll").attr("id",`list${e.id}`);switch(n.append(i),a.append(n),t){case 1:T.load().done(e=>{eI(e)});break;case 2:let o=P.option("currentDate");o=o.getFullYear(),C.load().done(e=>{eI(e)});break;default:let d=$("<div />").addClass("option search-option");$("#list3").append(d),$("#list3").append($("<div />").addClass("option groupChanged")),eM();let l=$("<div />").addClass("option equipChanged");$("#list3").append(l),l.append($("<span />").addClass("option-label").text("afficher les \xe9quipes...")),l.append($("<div />").addClass("switchEquip group-option").attr("id","switch-teams"));let r=$("<div />").addClass("option groupe-option");r.append($("<span />").addClass("option-label").text("Bureau")),$("#list3").append(r);let s=$("<div />").addClass("option groupe-option");s.append($("<span />").addClass("option-label").text("Salari\xe9s")),$("#list3").append(s);let u=$("<div />").addClass("option groupe-option");u.append($("<span />").addClass("option-label").text("Equipe")),$("#list3").append(u);let c=$("<div />").addClass("option groupe-option");c.append($("<span />").addClass("option-label").text("Jour non travaill\xe9")),$("#list3").append(c);let m=$("<div />").addClass("option groupe-option action");m.append($("<span />").addClass("option-label").text("Actions")),$("#list3").append(m),$.each([{group:d,text:"Rechercher",icon:"search",className:"buttonSearch",event:{intern:{name:eP,param:{contentOption:Y}}}},{group:r,text:"Gerer les heures de Bureau",icon:"ja-office",className:"buttonOffice",event:{intern:{name:eP,param:{contentOption:G}}}},{group:s,text:"G\xe9rer les abscences",icon:"ja-abs",className:"buttonAbsence",event:{intern:{name:eP,param:{contentOption:L}}}},{group:s,text:"Ajouter un salari\xe9",icon:"ja-add-sal",className:"buttonAddSalarie",event:{intern:{name:eP,param:{contentOption:N}}}},{group:s,text:"Voir les salari\xe9s",icon:"ja-show-sal",className:"buttonShowSalarie",event:{intern:{name:eP,param:{contentOption:U}}}},{group:u,text:"Ajouter une \xe9quipe",icon:"ja-add-team",className:"buttonShowEquipe",event:{intern:{name:eP,param:{contentOption:H}}}},{group:u,text:"Voir les \xe9quipes",icon:"ja-show-team",className:"buttonShowEquipe",event:{intern:{name:eP,param:{contentOption:z}}}},{group:c,text:"Jour non travaill\xe9",icon:"ja-calendar",className:"buttonUnworkedDay",event:{intern:{name:eP,param:{contentOption:W}}}},{group:m,text:"Actualiser",icon:"ja-reload",event:{fmScript:{name:"Actualiser",param:e$}}},{group:m,text:"Fiche travaux",icon:"ja-export",event:{fmScript:{name:"Creation_fiche_chantier",param:eq}}},{group:m,text:"Reconnexion",icon:"ja-admin",event:{fmScript:{name:"Reconnexion"}}}],function(e,t){eB(t)})}}}).dxAccordion("instance"),$(".listContent").dxScrollView({useNative:!1,showScrollbar:"onScroll"}).dxScrollView("instance");let J={message:"vous devez s\xe9lectionner au moin une \xe9quipe",type:"error"},X={message:"vous ne pouvez pas cr\xe9er d'\xe9venement pour cette date.",type:"warning"},K={message:"le SMS a bien \xe9t\xe9 envoy\xe9",type:"success"};function Q(){intervalId=setInterval(()=>{tu(new a("getNotification","",1))},5e3)}function Z(){P.repaint(),P.on([{initialized:eo()}])}function ee(){e0(),P.option("resources[0].dataSource",ep(B._array[0].teams,P.option("currentDate")))}function et(){1==B._array[0].drawer&&q.option("opened",!0),0!=B._array[0].currentDate.length&&(P.option("currentDate",new Date(B._array[0].currentDate)),B.update(B._array[0].id,{currentDate:""}))}function ea(){let e;return I.load().done(t=>{let a=t.filter(e=>1==e.bureau);e=0===a.length?"":a[0].id}),e}function en(){let e=$(".dx-scheduler-date-table-cell").width();$(".dx-scheduler-appointment-vertical").width(e+1.6)}function ei(){return(h-116)/21-1}function eo(){$(".dx-scheduler-view-switcher").remove(),$(".dx-scheduler-view-switcher-label").remove(),ev(),eh(),et(),R.hide()}function ed(e){let n=[{itemType:"group",name:"title",colCount:3,items:[]},{itemType:"group",name:"date",colCount:2,items:[{dataField:"startDate",label:{text:"Date de d\xe9but",visible:!1},editorType:"dxDateBox",editorOptions:{placeholder:"date de d\xe9but",width:"100%",type:"datetime",disabledDates(e){let t=eu(e),a="month"===e.view&&(t.weekend||t.chome);return a},onValueChanged(t){e.form.updateData("endDate",em(t.value,e))}}},{name:"endDate",dataField:"endDate",label:{text:"Date de fin",visible:!1},editorType:"dxDateBox",editorOptions:{placeholder:"date de fin",width:"100%",type:"datetime",disabledDates(e){let t=eu(e),a="month"===e.view&&(t.weekend||t.chome);return a}}}]},{itemType:"group",name:"description",colCount:1,items:[{name:"description",dataField:"devis.description",label:{text:"Description",visible:!1},colSpan:1,editorType:"dxTextArea",editorOptions:{displayExpr:"text",elementAttr:{id:"description"}}},{name:"observation",dataField:"observation",label:{text:"Observation",visible:!1},colSpan:1,editorType:"dxTextArea",editorOptions:{displayExpr:"text",elementAttr:{id:"observation"}}},{name:"clt_ref",dataField:"devis.client.clt_ref",label:{text:"clt_ref",visible:!1},colSpan:2,editorType:"dxTextArea",editorOptions:{displayExpr:"text",elementAttr:{id:"clt_ref"},visible:!1}}]},{itemType:"group",cssClass:"group-col-gap",name:"information",colCount:3,items:[{name:"statut",dataField:"statut",label:{visible:!1},editorType:"dxSelectBox",editorOptions:{visible:void 0!==e.component._editAppointmentData&&!(void 0!==e.component._editAppointmentData&void 0!==e.appointmentData.devis&void 0===e.appointmentData.devis.detail),placeholder:"Statut",dataSource:[{text:"Rendez-vous"},{text:"Message"},{text:"Non appel\xe9"},{text:"D\xe9faut"}],width:"100%",itemTemplate:e=>e.text,displayExpr:"text",value:void 0!==e.appointmentData.statut?e.appointmentData.statut:"D\xe9faut",valueExpr:"text",onOpened(e){e.component._popup.option("width",180)}}},{name:"equipe",dataField:"equipeID",label:{text:"Equipe",visible:!1},editorType:"dxSelectBox",editorOptions:{visible:void 0!==e.component._editAppointmentData&&!(void 0!==e.component._editAppointmentData&void 0!==e.appointmentData.devis&void 0===e.appointmentData.devis.detail),width:"100%",placeholder:"Equipe",dataSource:M,displayExpr:"text",valueExpr:"id"}},{name:"salarie",dataField:"salarieID",label:{text:"Salari\xe9s",visible:!1},editorType:"dxTagBox",editorOptions:{visible:void 0!==e.component._editAppointmentData&&!(void 0!==e.component._editAppointmentData&void 0!==e.appointmentData.devis&void 0===e.appointmentData.devis.detail),placeholder:"Salari\xe9s",width:"100%",dataSource:el(e.appointmentData.startDate,e.appointmentData.equipeID),value:new t(e.appointmentData.equipeID,e.appointmentData.salarieID),displayExpr:"prenom",valueExpr:"id",showSelectionControls:!0,onOpened(e){e.component._popup.option("width",230)}}}]}];return void 0!==e.component._editAppointmentData?n[0].items.push({name:"Titre_dvs",dataField:"devis.text",label:{text:"Titre",visible:!1},colSpan:3,editorType:"dxTextBox",editorOptions:{disabled:!0,displayExpr:"text",elementAttr:{id:"nom_dvs"},visible:!0}}):(n[0].items.push({name:"titre_select",dataField:"devis.text",label:{text:"Titre",visible:!1},colSpan:2,editorType:"dxSelectBox",editorOptions:{dataSource:w,valueExpr:"clt_nom",displayExpr:"clt_nom",itemTemplate:function(e,t,a){return $("<div />").append($("<div />").text(`${e.clt_nom}`).css({display:"inline-block","min-width":"50%","margin-right":"15px"}),$("<div />").text(`${e.clt_ville}`).css({display:"inline-block","text-align":"left"}))},elementAttr:{id:"nom"},width:"100%",type:"text",searchEnabled:!0,searchMode:"startswith",minSearchLength:1,acceptCustomValue:!0,visible:!0,onItemClick(t){t.itemData&&(ti(t.itemData.clt_ref),setDataClient=a=>{console.log(e.form.option()),textClt=`${JSON.parse(a).adres}
${JSON.parse(a).ville}
${JSON.parse(a).tel1}
${JSON.parse(a).tel2}`,e.form.option("items[2].items[0].editorOptions.value",textClt),e.form.option("items[2].items[2].editorOptions.value",t.itemData.clt_ref)})},onCustomItemCreating(t){if(!t.text||$(".dx-dialog").length){t.customItem=null;return}let a=x._array.map(e=>e.clt_ref),n=Math.max.apply(null,a)+1,i={clt_nom:t.text,clt_ref:n};t.customItem=w.store().insert(i).then(()=>ec(i,e)).then(()=>w.load()).then(()=>i).catch(e=>{throw e})}},validationRules:[{type:"required",message:"le titre est requis"}]}),n[0].items.push({name:"button_nouveau_client",label:{visible:!1},editorType:"dxButton",editorOptions:{width:"100%",text:"nouveau client",type:"success",elementAttr:{class:"button-nouveau-client"},visible:!0,onClick(){let t=x._array.map(e=>e.clt_ref),a=Math.max.apply(null,t)+1,n={clt_nom:"",clt_ref:a};w.store().insert(n),w.load(),ec(n,e)}}}),e.form.option("formData.statut","Rendez-vous")),void 0!==e.component._editAppointmentData&&(n.push({itemType:"group",name:"button_action",cssClass:"group-col-gap",colCount:3,items:[{name:"button_contact",label:{visible:!1},editorType:"dxButton",editorOptions:{width:"100%",text:"contacter",type:"success",elementAttr:{class:"button-contact"},onClick(){eR(e)}}}]}),(void 0===e.appointmentData.devis||void 0===e.appointmentData.devis.detail)&&n[4].items.push({name:"button_map",label:{visible:!1},editorType:"dxButton",editorOptions:{width:"100%",text:"map",type:"success",elementAttr:{class:"button-map"},visible:!0,onClick(){tu(new a("map adresse",e.appointmentData.devis.client.clt_ref,0))}}}),void 0!==e.appointmentData.devis&&void 0!==e.appointmentData.devis.detail)&&(n[4].items.push({name:"button_detail",label:{visible:!1},editorType:"dxButton",editorOptions:{width:"100%",text:"d\xe9tail",type:"success",elementAttr:{class:"button-detail"},visible:!0,onClick(){e2(e)}}}),n[4].items.push({name:"button_ficheTrav",label:{visible:!1},editorType:"dxButton",editorOptions:{width:"100%",text:"fiche travaux",type:"success",elementAttr:{class:"button-fiche-trav"},visible:!0,onClick(){e1(e)}}}),n[4].items.push({name:"button_suiviChantier",label:{visible:!1},editorType:"dxButton",editorOptions:{width:"100%",text:"suivi de chantier",type:"success",elementAttr:{class:"button-fiche-trav"},visible:!0,onClick(){eV(e)}}})),n}function el(e,t){let a,n,i;return E.filter("actif",1),E.load().done(e=>{a=e}),A.load().done(e=>{n=e}),O.load().done(e=>{i=e}),e=new Date(e).getTime(),3!=t?($.each(n,t=>{let i=n[t].startDate,o=n[t].endDate;new Date(i).getTime()<=e&&new Date(o).getTime()>=e&&(a=a.filter(e=>e.id!==n[t].salarieID))}),$.each(i,t=>{let n=new Date(i[t].startDate),o,d;switch(i[t].periodeID){case 1:d=(o=n.getTime()+288e5)+144e5;break;case 2:d=(o=n.getTime()+468e5)+18e6;break;case 3:d=(o=n.getTime()+288e5)+432e5}o<=e&&d>=e&&(a=a.filter(e=>e.id!==ea()))})):(a=a.filter(e=>e.id==ea()),$.each(n,t=>{let i=n[t].startDate,o=n[t].endDate;new Date(i).getTime()<=e&&new Date(o).getTime()>=e&&(a=a.filter(e=>e.id!==n[t].salarieID))})),a}function er(e,t){let a=$.grep(M._array,e=>e.id===t),n=a[0].defautSalId,i=el(e,t),o=[];return $.each(n,(e,t)=>{$.each(i,(e,a)=>{a.id===t&&o.push(a.id)})}),o}function es(e){let t=e.element.data("day");new Date(t).getTime(),O.filter("startDate",t),O.load().done(a=>{0!=a.length&&null===e.value?S.remove(a[0].id):0!=a.length&&null!==e.value?S.update(a[0].id,{periodeID:e.value}):S.insert({startDate:t,periodeID:e.value}),P.repaint(),P.on([{repaint:eo()}])})}function ep(e,t){let a=new Date(t).getTime(),n=[];return M._array.length>0?$.each(e,(e,t)=>{let i=$.grep(M._array,e=>e.id===t);new Date(i[0].startDate).getTime()<=a&&new Date(i[0].endDate).getTime()>=a&&n.push(i[0])}):n=[{id:"1"}],n}function eu(e){let t,a=$.grep(F._array,t=>{let a=new Date(t.startDate),n=new Date(t.endDate);return e.date.getTime()>=a.getTime()&&e.date.getTime()<=n.getTime()-6e4});t=a.length>0;let n=e.date.getDay(),i={};return i.chome=t,i.weekend=0===n||6===n,i}function ec(e,t){let a=DevExpress.ui.dialog.confirm("Voulez vous cr\xe9er un client dans l'application <i>jardin?</i>","Cr\xe9er un client");a.done(a=>{a&&ej(e,t)})}function em(e,t){let a=new Date(e),n=new Date(t.appointmentData.endDate),i=new Date(t.appointmentData.startDate),o=n.getTime()-i.getTime(),d=new Date(a.valueOf()+o);return d.getHours()>17&&d.setHours(17,0),d}function e$(){return eX(P.option("currentDate"))}function eh(){$("#button-sem .dx-button-text").text(ex(P.option("currentDate")))}function ev(){let e=$("<div />").appendTo(".dx-scheduler-header .dx-toolbar-items-container .dx-toolbar-after").addClass("wrapper-sem");$("<div />").appendTo(e).addClass("sem-label").text("semaine"),$("<div />").appendTo(e).attr({id:"button-sem",class:"sem"}),$("#button-sem").dxButton({stylingMode:"outlined",text:"0",type:"normal",width:36,onClick(){eP({contentOption:j})}})}function eg(e){let t=new Date(e),a=new Date(t),n;return n=0==e.getDay()?6:e.getDay()-1,t.setDate(e.getDate()-n),a.setDate(t.getDate()+6),t=e7(t),a=e7(a),result=new class e{constructor(e,t){this.dateStart=e,this.dateEnd=t}}(t,a)}function ex(e){let t;t=0==e.getDay()?e.getDate()+1:e.getDate(),(e=new Date(Date.UTC(e.getFullYear(),e.getMonth(),t))).setUTCDate(e.getUTCDate()+4-(e.getUTCDay()||7));let a=new Date(Date.UTC(e.getUTCFullYear(),0,1)),n=Math.ceil(((e-a)/864e5+1)/7);return n}function ew(e){let t=e.getFullYear();return t}function eb(e){let t={};return t.sem=ex(e),t.year=ew(e),t}function ef(e,t){let a=new Date;a.setUTCFullYear(t,0,1);let n=8-a.getDay(),i=7*(semLenght=n>=4?e-2:e-1)+n+1,o=new Date;o.setFullYear(t,0,i);let d=new Date(o);P.option("currentDate",d)}function eD(e,t,a,n,i){V.option({dataSource:t,target:i,itemTemplate:a,onItemClick:n,disabled:e})}function e_(e){return t=>{t.itemData.onItemClick(e,t)}}function eC(e){let t=$("<div />");return e.hasOwnProperty("checked")?t.dxCheckBox({value:e.checked,text:e.text}):t.append(e.text).addClass("appointment-context-menu"),t}function ey(e){let t=$("<div />");return t.append(e.text).addClass("cell-context-menu"),t}function eT(e){let t=P.option("groupByDate");optionText=!0==(t=!t)?"Grouper par \xe9quipe":"Grouper par date",v[1].text=optionText,P.option("groupByDate",t)}function eS(e){e.component.showAppointmentPopup({startDate:new Date(e.cellData.startDate),endDate:new Date(e.cellData.startDate.getTime()+18e5),equipeID:e.cellData.groups.equipeID},!0)}function eO(e){e.component.option("currentDate",new Date)}function ek(e){e.component.showAppointmentPopup(e.appointmentData)}function eA(e){e.component.deleteAppointment(e.appointmentData),eE(e.appointmentData,$(`#list${e.appointmentData.devis.typeID}`)),$(`.sem-${ex(P.option("currentDate"))}`).css("display","block")}function e8(e){let t=e.targetedAppointmentData;t.sdc&&delete t.sdc,delete t.id,e.component.addAppointment(t)}function e9(e,t){let a=e.appointmentData;e.component.updateAppointment(a,$.extend(a,{statut:t.itemData.text}))}function eF(e,t){V.option({disable:!0});let a=e.appointmentData,n=a.salarieID,i=t.itemData.id;-1!=$.inArray(i,n)?n.splice(n.indexOf(i),1):n.push(i),e.component.updateAppointment(a,$.extend(a,{salarieID:n})),V.show()}function eI(e){$.each(e,(e,t)=>{eE(t,$(`#list${t.devis.typeID}`))})}function eE(e,t){let a;a=1==e.devis.typeID?`itemSem sem-${e.contrat.sem}`:"",$("<div />").text(e.devis.text).addClass(`item dx-card dx-theme-background-color dx-theme-text-color item${e.devis.dvs_ref} ${a}`).appendTo(t).click(()=>{e2(e)}).dxDraggable({group:"dragging",data:e,clone:!0,onDragEnd(e){e.toData&&(e.cancel=!0),!1===c?e.cancel=!0:e.cancel=!1},onDragMove(e){$(".dx-scheduler-date-table-droppable-cell").hasClass("dx-template-chome")?(c=!1,e3(X)):c=!0},onDragStart(e){e.itemData=e.fromData}}),$(".itemSem").css("display","none"),$(`.sem-${ex(P.option("currentDate"))}`).css("display","block")}function eM(){let e=$("<div />").addClass("switchGroupe option-groupe"),t=$("<span />").text("Grouper par date").addClass("switchGroupLabel");$(".groupChanged").append(t).append(e),$(".switchGroupe").dxSwitch({name:"groupByDate",width:30,value:!0,onValueChanged(e){P.option("groupByDate",e.value),P.on([{repaint:eo()}])}})}function e0(){$(".switchEquip").empty();let e=B._array[0].teams;$.each(M._array,(t,a)=>{let n=a.startDate,i=a.endDate,o=P.option("currentDate");if(new Date(n).getTime()<=o&&new Date(i).getTime()>=o){let d;d=-1!==e.indexOf(a.id),$("<div />").attr("id",`checkboxTeam${a.id}`).addClass("checkboxTeam").appendTo(".switchEquip");let l=$(`#checkboxTeam${a.id}`).dxCheckBox({text:a.text,value:d,onValueChanged(t){!0===t.value?(e.push(a.id),P.option("resources[0].dataSource",ep(e,P.option("currentDate"))),B.update(B._array[0].id,{teams:e})):0==(e=e.filter(e=>e!==a.id)).length?(e3(J),l.option("value",!0)):(P.option("resources[0].dataSource",ep(e,P.option("currentDate"))),B.update(B._array[0].id,{teams:e}))}}).dxCheckBox("instance")}})}function eB(e){let t=$("<div />").addClass("bt-option"),n=$("<div />").addClass("button-option");t.append(n),e.group.append(t),n.dxButton({text:e.text,icon:e.icon,elementAttr:{class:e.className},type:"normal",onClick(){if(e.event.fmScript)return param=e.event.fmScript.param?(0,e.event.fmScript.param)():"",tu(new a(e.event.fmScript.name,param,0)),!0;{let t;(0,e.event.intern.name)(e.event.intern.param)}}})}function eq(){let e,t=new DevExpress.data.DataSource({paginate:!1,store:b,filter:[["startDate",">",eZ(P.getStartViewDate())],"and",["endDate","<",eZ(P.getEndViewDate())]],sort:"startDate"});return t.load().done(a=>{e=JSON.stringify(t._items)}),e}function e1(e){let t=[];t.push(e.appointmentData);let n=JSON.stringify(t);tu(new a("Creation_fiche_chantier",n,0))}function eR(e){ti(e.appointmentData.devis.client.clt_ref),setDataClient=t=>{eG(e,clt=JSON.parse(t))}}function eP(e){let t=new class e{constructor(e){this.contentOption=e,this.startPopup=()=>{i||$("<div />").attr("id","popupOption").appendTo("#planning"),(i=$("#popupOption").dxPopup(e).dxPopup("instance")).show()}}}(e.contentOption);t.startPopup()}function e3(e){let t=new class e{constructor(e){this.startToast=()=>{(o=o?$("#toast").dxToast(e).dxToast("instance"):$("<div />").attr("id","toast").appendTo("#planning").dxToast(e).dxToast("instance")).show()}}}(e);t.startToast()}function e2(e){d?d.option({contentTemplate:e5(e).contentTemplate.bind(this)}):($("<div />").attr("id","popup-devis-info").appendTo("#planning"),d=$("#popup-devis-info").dxPopup(e5(e)).dxPopup("instance")),d.show()}function eV(e){l?l.option({contentTemplate:e4(e).contentTemplate.bind(this),title:"suivi de chantier"}):($("<div />").attr("id","popup-time-result").appendTo("#planning"),l=$("#popup-time-result").dxPopup(e4(e)).dxPopup("instance")),l.show()}function ej(e,t){$("<div />").attr("id","popup-new-client").appendTo("#planning"),(u=$("#popup-new-client").dxPopup(eH(e,t)).dxPopup("instance")).show()}function eG(e,t){r?r.option({contentTemplate:e6(e,t).contentTemplate.bind(this),title:e.appointmentData.devis.text}):($("<div />").attr("id","popup-contact").appendTo("#planning"),r=$("#popup-contact").dxPopup(e6(e,t)).dxPopup("instance")),r.show()}function eL(e,t,a){s?s.option({contentTemplate:eU(e,t,a).contentTemplate.bind(this),title:"sms"}):($("<div />").attr("id","popup-sms").appendTo("#planning"),s=$("#popup-sms").dxPopup(eU(e,t,a)).dxPopup("instance")),s.show()}function eN(e,t){fetch("https://api.brevo.com/v3/transactionalSMS/sms",{method:"POST",headers:{accept:"application/json","content-type":"application/json","api-key":"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"},body:JSON.stringify({type:"transactional",unicodeEnabled:!1,sender:"33610225002",recipient:e,content:t,organisationPrefix:"Proxim Jardin"})}).then(e=>e.json()).then(function(){e3(K)}).catch(e=>console.log(e))}function e5(e){console.log(e);let t;return t=e.appointmentData?e.appointmentData:e,{width:500,height:450,showTitle:!0,title:"Information sur le devis",visible:!1,dragEnabled:!0,closeOnOutsideClick:!0,showCloseButton:!0,shading:!0,shadingColor:"rgba(134, 134, 134, 0.70)",wrapperAttr:{class:"devis-info-popup"},contentTemplate(){let n=$("<div />"),i=$("<div />").appendTo(n).addClass("wrapper-info-devis-form").css("margin-top","5px");i.dxForm({readOnly:!1,showColonAfterLabel:!0,labelMode:"floating",labelLocation:"top",minColWidth:200,height:"auto",colCount:1,showValidationSummary:!1,validationGroup:"formDevisInfo",items:[{itemType:"group",cssClass:"adresse-group",colCount:3,items:[{name:"adresse",dataField:"adresse",colSpan:3,label:{text:"Adresse chantier",visible:!1},editorOptions:{value:t.devis.adresse.adrch,disabled:!1,readOnly:!0}},{dataField:"ville",colSpan:2,label:{text:"Ville",visible:!1},editorOptions:{value:t.devis.adresse.adrch_ville,disabled:!1,readOnly:!0}},{name:"button_nouveau_client",label:{visible:!1},editorType:"dxButton",editorOptions:{width:"100%",text:"map",type:"success",elementAttr:{class:"button-map"},onClick(){let e={};e.adresse=t.devis.adresse;let n=JSON.stringify(e);tu(new a("map adresse chantier",n,0))}}}]}]}).dxForm("instance");let o=$("<div />").addClass("ja-textarea").appendTo(n),l=$("<div />").attr("id","contenu_devis").addClass("container-cont").appendTo(o),r=$("<div />").addClass("toolbar-time-result").appendTo(o),s=l.dxTreeList({dataSource:t.devis.detail.cont,itemsExpr:"sub_cont",dataStructure:"tree",columns:[{dataField:"descr",caption:"Description",cellTemplate(e,t){let a=t.data.descr;e.append($("<span>",{class:"descr",html:a}))}},{dataField:"h_prevu",caption:"H"}],selection:{mode:"multiple",recursive:!0},autoExpandAll:!0,showRowLines:!0,showBorders:!0,columnAutoWidth:!0,wordWrapEnabled:!0,onRowPrepared(e){(0==e.level||"header"===e.rowType)&&e.rowElement.find("td").css("font-weight","1000")},onCellPrepared(e){"data"==e.rowType&&0==e.row.level&&e.cellElement.find("div.dx-treelist-icon-container").remove()},onNodesInitialized(e){let t=[];s.forEachNode(function(e){let a=e.data;if(1===a.termine){let n=a.id;t.push(n)}}),s.option("selectedRowKeys",t)}}).dxTreeList("instance");return r.dxToolbar({items:[{toolbar:"bottom",widget:"dxButton",location:"after",options:{text:"valider",onClick(){let n=s.getSelectedRowKeys("leavesOnly");console.log(e),$.each(t.devis.detail.cont,(e,t)=>{$.each(t.sub_cont,(e,t)=>{n.includes(t.id)?t.termine=1:t.termine=0})}),e.component.updateAppointment(t,t);let i={};i.data=n,i.structure=t.devis.structure,i.dvs_ref=t.devis.dvs_ref,i=JSON.stringify(i),console.log(i),tu(new a("scdvsTermine",i,0)),d.hide()}}},{toolbar:"bottom",widget:"dxButton",location:"after",options:{text:"Annuler",onClick(){d.hide()}}}]}).dxToolbar("instance"),n.dxScrollView({height:"100%",width:"100%"}).dxScrollView("instance"),n}}}function e4(e){return{width:700,height:450,showTitle:!0,title:"Temps pass\xe9 sur le chantier",visible:!1,dragEnabled:!0,closeOnOutsideClick:!0,showCloseButton:!0,shading:!0,shadingColor:"rgba(134, 134, 134, 0.70)",wrapperAttr:{class:"time-result-popup"},contentTemplate(){let t=$("<div />"),n=$("<div />").appendTo(t),i=$("<div />").appendTo(t),o=$("<div />").addClass("toolbar-time-result").appendTo(t),d=e.appointmentData,r,s;r=(s=!!d.sdc&&0!=d.sdc.length)?d.sdc:[];let u={H:e=>e>=0&&e<=2,h:(e,t,a)=>"2"==a[0]?[0,1,2,3].includes(parseInt(e)):[0,1,2,3,4,5,6,7,8,9].includes(parseInt(e)),M:e=>e>=0&&e<=5,m:e=>e>=0&&e<=9},c=eQ(new Date(d.startDate)),m=d.devis.dvs_ref;s||$.each(d.salarieID,(e,t)=>{let a={};I.load({filter:["id",t]}).done(e=>{let t=`${e[0].prenom} ${e[0].nom}`;a.salarie_name=t,a.dvs_ref=m,a.date=c}),r.push(a)});let h=i.dxDataGrid({dataSource:r,showBorders:!0,editing:{mode:"popup",allowUpdating:!0,allowAdding:!0,allowDeleting:!0,popup:{showTitle:!1,width:500,height:350},form:{items:[{itemType:"group",colSpan:2,colCount:2,items:[{dataField:"salarie_name",editorType:"dxSelectBox",editorOptions:{dataSource:E,valueExpr(e){if(null!=e)return`${e.prenom} ${e.nom}`},displayExpr(e){if(null!=e)return`${e.prenom} ${e.nom}`}}}]},{itemType:"group",colSpan:2,colCount:3,items:[{dataField:"heure_a"},{dataField:"heure_d"},{dataField:"trajet"}]},{itemType:"group",colCount:2,items:[{dataField:"pause_a"},{dataField:"pause_d"}]}]}},columns:[{allowEditing:!1,dataField:"appointmentID",visible:!1},{dataField:"salarie_name",caption:"Nom",validationRules:[{type:"required",message:"requis"}]},{dataField:"heure_a",caption:"heure d'arriv\xe9e",editorOptions:{mask:"Hh:Mm",maskRules:u,useMaskedValue:!0,showMaskMode:"onFocus"}},{dataField:"heure_d",caption:"heure de d\xe9part",editorOptions:{mask:"Hh:Mm",maskRules:u,useMaskedValue:!0,showMaskMode:"onFocus"}},{dataField:"trajet",caption:"temps de trajet",validationRules:[{type:"required",message:"requis"}]},{dataField:"pause_a",caption:"d\xe9but de pause",editorOptions:{mask:"Hh:Mm",maskRules:u,useMaskedValue:!0,showMaskMode:"onFocus"}},{dataField:"pause_d",caption:"fin de pause",editorOptions:{mask:"Hh:Mm",maskRules:u,useMaskedValue:!0,showMaskMode:"onFocus"}}],onRowInserting(e){e.data.date=c,e.data.dvs_ref=m,e.data.pause_a||(e.data.pause_a=""),e.data.pause_d||(e.data.pause_d="")}}).dxDataGrid("instance");return s||n.dxForm({readOnly:!1,showColonAfterLabel:!0,labelMode:"floating",labelLocation:"top",minColWidth:200,height:"auto",colCount:1,showValidationSummary:!1,validationGroup:"formTimeResult",items:[{itemType:"group",cssClass:"info-group",colCount:3,items:[{dataField:"heure_a",label:{text:"Heure d'arriv\xe9e",visible:!1},editorOptions:{value:"",mask:"Hh:Mm",maskRules:u,useMaskedValue:!0,showMaskMode:"onFocus"},validationRules:[{type:"required",message:"requis"}]},{dataField:"heure_d",label:{text:"Heure de d\xe9part",visible:!1},editorOptions:{value:"",mask:"00:00",maskRules:u,useMaskedValue:!0,showMaskMode:"onFocus"},validationRules:[{type:"required",message:"requis"}]},{dataField:"trajet",label:{text:"Temps de trajet",visible:!1},editorOptions:{value:""},validationRules:[{type:"required",message:"requis"}]},{dataField:"pause_a",label:{text:"d\xe9but de pause",visible:!1},editorOptions:{value:"",mask:"00:00",maskRules:u,useMaskedValue:!0,showMaskMode:"onFocus"}},{dataField:"pause_d",label:{text:"fin de pause",visible:!1},editorOptions:{value:"",mask:"00:00",maskRules:u,useMaskedValue:!0,showMaskMode:"onFocus"}}]}],onFieldDataChanged(e){$.each(r,(t,a)=>{"heure_a"==e.dataField?a.heure_a=e.value:"heure_d"==e.dataField?a.heure_d=e.value:"trajet"==e.dataField?a.trajet=e.value:"pause_a"==e.dataField?a.pause_a=e.value:a.pause_d=e.value}),h.refresh()}}).dxForm("instance"),s?o.dxToolbar({items:[{toolbar:"bottom",widget:"dxButton",location:"after",options:{text:"valider",onClick(){let t=h.option("dataSource");if(0==t.length)t=JSON.stringify(t),tu(new a("createSuiviChantier",t,0)),l.hide();else{e.component.updateAppointment(d,$.extend(d,{sdc:t}));let n={};n.data=t,n.structure=d.devis.structure,n.appointmentID=d.id,n=JSON.stringify(n),tu(new a("createSuiviChantier",n,0)),l.hide()}}}},{toolbar:"bottom",widget:"dxButton",location:"after",options:{text:"Annuler",onClick(){l.hide()}}}]}).dxToolbar("instance"):o.dxToolbar({items:[{toolbar:"bottom",widget:"dxButton",location:"after",options:{text:"valider",validationGroup:"formTimeResult",onClick:function t(n){if(!0===n.validationGroup.validate().isValid){let i=h.option("dataSource");e.component.updateAppointment(d,$.extend(d,{sdc:i}));let o={};o.data=i,o.structure=d.devis.structure,o.appointmentID=d.id,o=JSON.stringify(o),tu(new a("createSuiviChantier",o,0)),l.hide()}}}},{toolbar:"bottom",widget:"dxButton",location:"after",options:{text:"Annuler",onClick(){l.hide()}}}]}).dxToolbar("instance"),t}}}function e6(e,t){let n={colCount:2,width:390,height:350,showTitle:!0,title:e.appointmentData.devis.text,visible:!1,dragEnabled:!1,closeOnOutsideClick:!0,showCloseButton:!0,shading:!0,shadingColor:"rgba(134, 134, 134, 0.70)",wrapperAttr:{class:"popup-contacter"},contentTemplate(){let n=$("<div />").addClass("containerContact"),i=$("<div />").appendTo(n),o=$("<div />").addClass("tel-content").appendTo(i),d,l,r,s;if(t.hasOwnProperty("contact")?($("<div />").html(`<p>Les informations de contact suivante sont celles de ${t.contact.nom}</br>${t.contact.observation} </p>`).prependTo(n),d=t.contact.tel1,l=t.contact.tel2,s=t.contact.mail,contactNom=t.contact.nom):(d=t.tel1,l=t.tel2,s=t.mail,contactNom=""),"06"===l.substring(0,2)||"07"===l.substring(0,2)?r=l:("06"===d.substring(0,2)||"07"===d.substring(0,2))&&(r=d),$("<div />").addClass("tel").dxTextBox({value:d,readOnly:!0,label:"T\xe9l\xe9phone",labelMode:"static"}).appendTo(o),$("<div />").addClass("tel").dxTextBox({value:l,readOnly:!0}).appendTo(o),void 0!==r){let u=$("<div />").addClass("sms-button-content").appendTo(i),c=$("<div />").addClass("button-mail");c.dxButton({width:120,text:"SMS",type:"success",onClick(){eL(e,r,t)}}).appendTo(u)}if(0!=s.length){let m=$("<div />").appendTo(n).css({"margin-top":"40px"}),h=$("<div />").addClass("mail-content").appendTo(m);$("<div />").addClass("mail").dxTextBox({value:s,readOnly:!0,label:"Email",labelMode:"static"}).appendTo(h);let v=$("<div />").addClass("button-mail");v.dxButton({width:120,text:"mail",type:"success",onClick(){let n=tt(e.appointmentData,t,"mail"),i={mail:s,mailText:n};i=JSON.stringify(i),tu(new a("creation_mail",i,0)),e.component.updateAppointment(e.appointmentData,$.extend(e.appointmentData,{statut:"Message"}))}}).appendTo(h)}return n}};return n}function eU(e,t,a){return{colCount:1,width:390,height:350,showTitle:!0,title:"sms",visible:!1,dragEnabled:!1,closeOnOutsideClick:!0,showCloseButton:!0,shading:!0,shadingColor:"rgba(134, 134, 134, 0.70)",wrapperAttr:{class:"popup-sms"},contentTemplate(){let n=$("<div />").addClass("containersms"),i=$("<div />").appendTo(n);smsText=tt(e.appointmentData,a,"sms"),$("<div />").addClass("sms").dxTextArea({value:smsText,readOnly:!1,label:"texte",labelMode:"static",height:200,onValueChanged:function(e){smsText=e.value}}).appendTo(i);let o=$("<div />").addClass("sms-button-content").appendTo(i),d=$("<div />").addClass("button-sms");return d.dxButton({text:"envoyer",width:150,type:"success",onClick(){eN(tn(t),smsText),$("#popup-sms").dxPopup("hide")}}).appendTo(o),n}}}function eH(e,t){let n;return{width:500,height:450,showTitle:!0,title:"ajouter un client",visible:!1,dragEnabled:!0,closeOnOutsideClick:!0,shading:!1,wrapperAttr:{class:"addClient-popup"},contentTemplate(){let e=$("<div />").addClass("wrapper-AddClient-popup").dxScrollView({width:"100%",height:"100%"});return n=e.dxForm({readOnly:!1,showColonAfterLabel:!0,labelMode:"floating",labelLocation:"top",minColWidth:200,height:320,colCount:1,showValidationSummary:!1,validationGroup:"addClient",items:[{itemType:"group",cssClass:"nom-group",colCount:5,items:[{dataField:"civilite",colSpan:1,label:{text:"Civilit\xe9",visible:!1},editorType:"dxSelectBox",editorOptions:{items:["M","Mme","M et Mme","M et M","Mme et Mme"],value:"",disabled:!1,onOpened(e){setTimeout(()=>{e.component.content().parent().width(140)})}},validationRules:[{type:"required",message:"la civilit\xe9 est requise"}]},{name:"nom",dataField:"nom",colSpan:2,label:{text:"Nom",visible:!1},editorOptions:{value:"",disabled:!1,width:150},validationRules:[{type:"required",message:"le nom est requis"}]},{dataField:"prenom",colSpan:2,label:{text:"pr\xe9nom",visible:!1},editorOptions:{value:"",disabled:!1,width:150},validationRules:[{type:"required",message:"le pr\xe9nom est requis"}]}]},{itemType:"group",cssClass:"adresse-group",colCount:1,items:[{dataField:"adres1",label:{text:"Adresse",visible:!1},editorOptions:{value:"",disabled:!1},validationRules:[{type:"required",message:"l'adresse est requise"}]},{dataField:"adres2",label:{text:"",visible:!1},editorOptions:{value:"",disabled:!1}},{itemType:"group",cssClass:"cp-ville-group",colCount:5,items:[{dataField:"cp",label:{text:"CP",visible:!1},editorOptions:{value:"",disabled:!1,mask:"00000"},validationRules:[{type:"required",message:"le code postal est requis"}]},{dataField:"ville",colSpan:4,label:{text:"Ville",visible:!1},editorOptions:{value:"",disabled:!1},validationRules:[{type:"required",message:"la ville est requise"}]}]}]},{itemType:"group",cssClass:"contact-group",colCount:2,items:[{dataField:"tel1",label:{text:"Telephone",visible:!1},editorOptions:{value:"",disabled:!1,mask:"00 00 00 00 00"}},{dataField:"mail1",label:{text:"Email",visible:!1},editorOptions:{value:"",disabled:!1}},{dataField:"tel2",label:{text:"Telephone",visible:!1},editorOptions:{value:"",mask:"00 00 00 00 00"}},{dataField:"mail2",label:{text:"Email",visible:!1},editorOptions:{value:"",disabled:!1}}]}]}).dxForm("instance"),e},toolbarItems:[{toolbar:"bottom",widget:"dxButton",location:"after",options:{text:"ok",validationGroup:"addClient",onClick:function i(o){let d=o.validationGroup.validate();if(!0===d.isValid){let l=n._options._optionManager._options.formData,r=JSON.stringify(l);r=eJ(r),tu(new a("Creation_client",r,0));let s=l.adres2?`${l.adres1}
${l.adres2}`:`${l.adres1}`,c=`${l.nom} ${l.prenom}`,m=`${s}
${l.ville}
${l.tel1}
${l.tel2}`;t.form.option("items[0].items[0].editorOptions.value",c),t.form.option("items[2].items[0].editorOptions.value",m),t.form.option("items[2].items[2].editorOptions.value",e.clt_ref),u.hide(),$("#popup-new-client").remove()}}}},{toolbar:"bottom",widget:"dxButton",location:"after",options:{text:"Annuler",onClick(e){u.hide(),$("#popup-new-client").remove()}}}]}}function ez(e,t){let a;E.filter("actif",1),E.load().done(e=>{a=e});let n=$("<div>").dxTagBox({dataSource:a,value:t.value,valueExpr:"id",displayExpr:"prenom",showSelectionControls:!0,maxDisplayedTags:3,showMultiTagOnly:!1,applyValueMode:"useButtons",searchEnabled:!0,onValueChanged(e){t.setValue(e.value)},onSelectionChanged(){t.component.updateDimensions()},onOpened(e){e.component._popup.option("width",230)}});return n}function eW(e,t){return $("<div>").dxColorBox({value:t.value,onValueChanged(e){t.setValue(e.value)},applyButtonText:"ok"})}function eY(){let e=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let a=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?a:3&a|8).toString(16)})}function eJ(e){return e=(e=e.replace(/'/g,"''")).replace(/\n|\r|(\n\r)/g,"/r")}function e7(e){let t=e.getMonth()+1,a=e.getDate(),n;return a<10&&(a=`0${a}`),t<10&&(t=`0${t}`),`${e.getFullYear()}/${t}/${a}`}function eX(e){let t=e.getMonth()+1,a;return`${e.getFullYear()}/${t}/${e.getDate()}`}function eK(e){var t=e.split("/");return`${t[2]}/${t[1]}/${t[0]}`}function eQ(e){let t=e.getMonth()+1,a=e.getDate(),n=e.getFullYear();return e.getHours(),e.getMinutes(),e.getSeconds(),a<10&&(a=`0${a}`),t<10&&(t=`0${t}`),`${a}/${t}/${n}`}function eZ(e){let t=e.getMonth()+1,a=e.getDate(),n=e.getFullYear(),i=e.getHours(),o=e.getMinutes(),d=e.getSeconds();return a<10&&(a=`0${a}`),t<10&&(t=`0${t}`),i<10&&(i=`0${i}`),o<10&&(o=`0${o}`),d<10&&(d=`0${d}`),`${n}/${t}/${a} ${i}:${o}:${d}`}function te(e){let t=new Date(e),a=t.getMonth(),n=t.getDay(),i=t.getDate(),o=60*t.getHours()+t.getMinutes();return`${["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"][n]} ${i} ${["janvier","f\xe9vrier","mars","avril","mai","juin","juillet"," ao\xfbt","septembre","octobre","novembre","d\xe9cembre"][a]} ${["d\xe8s 8h15/8h30","en d\xe9but de matin\xe9e","en milieu de matin\xe9e","en fin de matin\xe9e ou d\xe9but d'apr\xe8s-midi","en d\xe9but d'apr\xe8s-midi","vers 15h30"][p=o<540?0:o<600?1:o<690?2:o<840?3:o<900?4:5]}`}function tt(e,t,a){let n;return e.devis.hasOwnProperty("detail")?e.contrat.hasOwnProperty("an")?`Bonjour ${t.hasOwnProperty("contact")?`${t.contact.nom}`:`${t.nom}`}

Une intervention est pr\xe9vue ${t.hasOwnProperty("contact")?`chez ${t.nom}`:""} le ${te(e.startDate)}

Cordialement
${"sms"==a?"PROXIM JARDIN\n\nPour nous joindre par t\xe9l\xe9phone: 02 43 81 07 14":""}`:`Bonjour ${t.hasOwnProperty("contact")?`${t.contact.nom}`:`${t.nom}`}

L'intervention ${e.devis.description[0].toLowerCase().match(/[aeiouyéè]/g)?"d'":"de "}${e.devis.description.toLowerCase()} est pr\xe9vue ${t.hasOwnProperty("contact")?`chez ${t.nom}`:""} le ${te(e.startDate)}

Cordialement
${"sms"==a?"PROXIM JARDIN\n\nPour nous joindre par t\xe9l\xe9phone: 02 43 81 07 14":""}`:`Bonjour ${t.nom}

Je vous confirme notre rendez-vous le ${ta(e.startDate)}

Cordialement
${"sms"==a?"PROXIM JARDIN\n\nPour nous joindre par t\xe9l\xe9phone: 02 43 81 07 14":""}`}function ta(e){let t=new Date(e),a=t.getMonth(),n=t.getDay(),i=t.getDate(),o=t.getHours(),d=t.getMinutes();return d<10&&(d=`0${d}`),0==d&&(d=""),`${["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"][n]} ${i} ${["janvier","f\xe9vrier","mars","avril","mai","juin","juillet"," ao\xfbt","septembre","octobre","novembre","d\xe9cembre"][a]} \xe0 ${o} heure ${d}`}function tn(e){let t=e.replace(/\s+/g,"");return`33${t=t.substring(1)}`}function ti(e){return tu(new a("getDataClient",e,0)),!0}function to(e){let t=eg(e),i=t.dateStart,o=JSON.stringify(t);return n.includes(i)||(n.push(i),tu(new a("getDataAppointment",o,0))),!0}function td(e){let t=JSON.stringify(e);return tu(new a("getDataAnnuel",t,0)),!0}function tl(e){let t=JSON.stringify(e);return tu(new a("maj_Appointment",t,0)),!0}function tr(e,t,n){delete n.id;let i="";$.each(n,(e,t)=>{let a;"description"==e&&(t=eJ(t)),i=`${i}${t=`${e}!!${a="string"==typeof t||"object"==typeof t?`'${t}'`:t}`},`}),i=i.substring(0,i.length-1);let o=`!E!UPDATE ${e} SET ${i} WHERE id!!'${t}'`;tu(new a("maj_Planning",o,0))}function ts(e,t){let n="",i=Object.keys(t).join(",");$.each(t,(e,t)=>{let a;"description"==e&&(t=eJ(t)),n=`${n}${a="string"==typeof t||"object"==typeof t?`'${t}'`:t},`}),n=n.substring(0,n.length-1);let o=`!E!INSERT INTO ${e} (${i}) VALUES (${n})`;tu(new a("maj_Planning",o,0))}function tp(e,t){let n=`!E!DELETE FROM ${e} WHERE id!!'${t}'`;tu(new a("maj_Planning",n,0))}function tu(e){return FileMaker.PerformScriptWithOption(e.script,e.param,e.option),!0}setNotification=e=>{let t=JSON.parse(e);e3({message:t.data,type:"success",position:{at:"right top",offset:"-200 50"},displayTime:5e3,width:"auto",animation:{show:{type:"fade",duration:400,from:0,to:1},hide:{type:"fade",duration:400,from:1,to:0}}})},majListAnnuel=e=>{e==ex(P.option("currentDate"))&&td(eb(P.option("currentDate")))},setData=e=>{let t=JSON.parse(e),a=t.store,n=[{store:I,event:{name:"salarie"}},{store:M,event:{name:"teams",callback:ee}},{store:F,event:{name:"chome"}},{store:k,event:{name:"absence"}},{store:S,event:{name:"office"}},{store:B,event:{name:"param"}},{store:b,event:{name:"appointment"}},{store:D,event:{name:"appointment_list"}},{store:y,event:{name:"ponctuel"}},{store:_,event:{name:"annuel"}},{store:x,event:{name:"client",callback:Z}}],i=$.grep(n,function(e,t){return e.event.name==a}),o=i[0].store;(o==_||o==y)&&o.clear();let d=t.data;d.forEach((e,t)=>{o.push([{type:"insert",data:e,index:t}])});(0,i[0].event.callback)()}});
